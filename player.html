<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Player Profile</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- SITE HEADER START -->
<header class="siteHeader">
  <div class="siteHeader__inner">
    <a class="brandChip" href="index.html" aria-label="Go to home">
      <span class="brandDot" aria-hidden="true"></span>
      <div>
        <div class="brandText">DC <b>Franchise</b> Database</div>
        <span class="brandSub">Local static website â€¢ Season 5 is live â€¢ Click to explore</span>
      </div>
    </a>

    <div class="statsChip">
      <div class="big">5 seasons â€¢ 58 players</div>
      <div class="small">Icons: <code>name.png</code></div>
    </div>
  </div>

  <nav class="siteNav" aria-label="Primary">
    <a class="navPill" href="index.html"><span class="navIcon">ğŸ </span>Home</a>
    <a class="navPill" href="current-season.html"><span class="navIcon">ğŸ“Š</span>Current Season</a>
    <a class="navPill" href="voting-analytics.html"><span class="navIcon">ğŸ§¾</span>Voting Analytics</a>
    <a class="navPill" href="franchise.html"><span class="navIcon">ğŸ›ï¸</span>Franchise</a>
    <a class="navPill" href="rankings.html"><span class="navIcon">ğŸ†</span>Rankings</a>
    <a class="navPill" href="seasons.html"><span class="navIcon">ğŸ—‚ï¸</span>Seasons</a>
    <a class="navPill" href="devotees.html"><span class="navIcon">ğŸ‘¥</span>Players</a>
    <a class="navPill" href="awards.html"><span class="navIcon">ğŸ…</span>Awards</a>
  </nav>
</header>
<!-- SITE HEADER END -->

<div class="container">
  <div class="topbar">
    <div>
      <div class="brand">DC <span>Franchise</span> Database</div>
      <div class="meta">Local static website â€¢ Click seasons + player profiles â€¢ Search + sort included</div>
    </div>
    <div class="meta">Season count: 4 â€¢ Player count: 40</div>
  </div>
  <div class="tabs">
    <a class="tab" href="current-season.html">ğŸ“Š Current Season Analytics</a>
    <a class="tab" href="voting-analytics.html">ğŸ—³ï¸ Voting Chart Analytics</a>
    <a class="tab" href="franchise.html">ğŸ›ï¸ Franchise Analytics</a>
    <a class="tab" href="rankings.html">ğŸ† Player Rankings</a>
    <a class="tab" href="seasons.html">ğŸ“š Seasons</a>
    <a class="tab active" href="devotees.html">ğŸ‘¥ Devotees</a>
    <a class="tab" href="awards.html">ğŸ¥‡ Season Awards</a>
  </div>
  
  <!-- Loading state -->
  <div id="loading" style="text-align:center; padding:60px 0;">
    <p style="font-size:18px; color:#666;">Loading player data...</p>
  </div>
  
  <!-- Error state -->
  <div id="error" style="display:none; text-align:center; padding:60px 0;">
    <h2 style="color:#e53e3e;">Player Not Found</h2>
    <p style="color:#666; margin:20px 0;">The requested player could not be found.</p>
    <a class="tab" href="devotees.html">â† Back to Players</a>
  </div>
  
  <!-- Player profile content -->
  <div id="player-content" style="display:none;">
    <!-- Content will be inserted here by JavaScript -->
  </div>

  <div class="footer">4 seasons complete â€¢ 40 unique players â€¢ 68 total appearances</div>
</div>

<!-- SITE FOOTER START -->
<footer class="siteFooter">
  <div class="footerInner">
    <div class="footerTitle">DC Franchise Database</div>
    <div class="footerSub">Static archive â€¢ 5 seasons â€¢ 58 players â€¢ Icons: name.png</div>
  </div>
</footer>
<!-- SITE FOOTER END -->

<script>
// Get player ID from URL parameter
const urlParams = new URLSearchParams(window.location.search);
const playerId = urlParams.get('player');

if (!playerId) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('error').style.display = 'block';
} else {
  // Load player data from JSON
  fetch('players_database.json')
    .then(response => response.json())
    .then(data => {
      const player = data.players.find(p => p.id === playerId);
      
      if (!player) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        return;
      }
      
      // Update page title
      document.title = `${player.name} â€“ Profile`;
      
      // Render player profile
      renderPlayerProfile(player);
      
      document.getElementById('loading').style.display = 'none';
      document.getElementById('player-content').style.display = 'block';
    })
    .catch(error => {
      console.error('Error loading player data:', error);
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
    });
}

function renderPlayerProfile(player) {
  const container = document.getElementById('player-content');
  
  // Sort seasons in reverse chronological order (most recent first)
  const sortedSeasons = [...player.seasonDetails].sort((a, b) => b.season - a.season);
  const mostRecentSeason = sortedSeasons[0];
  const olderSeasons = sortedSeasons.slice(1);
  
  // Build season links
  const seasonLinks = player.seasons.map(s => 
    `<a class="tab" href="seasons/season${s}.html">Season ${s}</a>`
  ).join('\n      ');
  
  // Build badges HTML
  const badgesHtml = player.badges && player.badges.length > 0 
    ? `<div class="badges">${player.badges.map(badge => {
        let badgeClass = 'badge';
        if (badge.includes('WINNER') || badge.includes('Winner') || badge.includes('Runner-Up')) badgeClass += ' gold';
        else if (badge.includes('Strategic') || badge.includes('Social')) badgeClass += ' purple';
        else if (badge.includes('Unbreakable') || badge.includes('Perfect') || badge.includes('Placement')) badgeClass += ' good';
        return `<span class='${badgeClass}'>${badge}</span>`;
      }).join('')}</div>`
    : '';
  
  // Build hero section
  let heroHtml = `
<div class="hero" style="text-align:left">
  <div class="row" style="justify-content:space-between; align-items:flex-start; gap:16px; flex-wrap:wrap">
    <div class="row" style="gap:14px">
      <div class="avatar" style="position:relative; overflow:hidden; width:80px; height:80px">
        <img src="assets/avatars/${player.id}.png" alt="" style="width:100%;height:100%;object-fit:cover" id="img-${player.id}"/>
        <span id="fallback-${player.id}" style="display:none">ğŸ‘¤</span>
      </div>
      <div>
        <h1 style="margin:0 0 6px">${player.name}${player.wins > 0 ? ' ğŸ†' : ''}</h1>
        <div class="sub">Seasons: ${player.seasons.join(', ')} â€¢ Best: #${player.bestPlacement}${player.wins > 0 ? ` (WINNER S${player.seasons.find(s => {
          const seasonData = player.seasonDetails.find(sd => sd.season === s);
          return seasonData && seasonData.placement === 1;
        })}!)` : ''} â€¢ Wins: ${player.wins}</div>
        <div class="small" style="margin-top:6px">
          <b>Avatar slot:</b> add image at <span class="tag">assets/avatars/${player.id}.png</span>
        </div>
      </div>
    </div>
    <div class="row" style="gap:10px">
      <a class="tab" href="devotees.html">â† Devotees</a>
      ${seasonLinks}
    </div>
  </div>
</div>

<div class="section-title">
  <h2>Career Summary</h2>
  <div class="hint">${player.totalSeasons} season${player.totalSeasons > 1 ? 's' : ''}</div>
</div>

<div class="statsbar">
  <div class="stat"><div class="num">${player.totalSeasons}</div><div class="label">Seasons</div></div>
  <div class="stat"><div class="num">${player.wins}</div><div class="label">Wins</div></div>
  <div class="stat"><div class="num">#${player.bestPlacement}</div><div class="label">Best Place</div></div>
  <div class="stat"><div class="num">${player.totalChallengeWins}</div><div class="label">Challenge Wins</div></div>
</div>

${badgesHtml}
`;

  // Build most recent season details
  heroHtml += `
<div class="section-title" style="margin-top:26px">
  <h2>ğŸ”¥ Season ${mostRecentSeason.season}${mostRecentSeason.season === 1 ? ' â€“ Total Drama: Cullhouse' : mostRecentSeason.season === 2 ? ' â€“ Total Drama 2' : mostRecentSeason.season === 3 ? ' â€“ Revenge of the Island' : ' â€“ Edge of Extinction'}</h2>
  <div class="hint">Most Recent</div>
</div>

${renderSeasonDetails(mostRecentSeason, true)}
`;

  // Build older seasons
  olderSeasons.forEach(season => {
    heroHtml += `
<div class="section-title" style="margin-top:26px">
  <h2>ğŸ“Š Season ${season.season}${season.season === 1 ? ' â€“ Total Drama: Cullhouse' : season.season === 2 ? ' â€“ Total Drama 2' : season.season === 3 ? ' â€“ Revenge of the Island' : ' â€“ Edge of Extinction'}</h2>
</div>
${renderSeasonDetails(season, false)}
`;
  });

  // Build player story
  if (player.story) {
    heroHtml += `
<div class="section-title" style="margin-top:26px">
  <h2>Player Story</h2>
</div>
<div class="panel">
  <p>${player.story}</p>
</div>
`;
  }

  // Build career totals
  heroHtml += `
<div class="section-title" style="margin-top:26px">
  <h2>Career Totals</h2>
</div>

<div class="statsbar">
  <div class="stat"><div class="num">${player.totalVotesAgainst}</div><div class="label">Total Votes Against</div></div>
  <div class="stat"><div class="num">${player.totalChallengeWins}</div><div class="label">Total Challenge Wins</div></div>
  <div class="stat"><div class="num">${player.totalImmunityWins}</div><div class="label">Total Immunity Wins</div></div>
  ${player.totalJuryVotes !== undefined ? `<div class="stat"><div class="num">${player.totalJuryVotes}</div><div class="label">Total Jury Votes</div></div>` : `<div class="stat"><div class="num">${player.totalIdolsFound || 0}</div><div class="label">Total Idols Found</div></div>`}
</div>
`;

  // Add avatar fallback script
  heroHtml += `
<script>
const img = document.getElementById("img-${player.id}");
const fb = document.getElementById("fallback-${player.id}");
if(img) {
  img.onload = () => { img.style.display="block"; if(fb) fb.style.display="none"; };
  img.onerror = () => { img.style.display="none"; if(fb) fb.style.display="block"; };
}
</script>
`;

  container.innerHTML = heroHtml;
}

function renderSeasonDetails(season, isMostRecent) {
  let html = '<div class="kpi-grid">\n  <div class="kpi">\n    <h3>Placement</h3>\n    <ul>\n';
  
  html += `      <li><b>Rank:</b> #${season.placement}`;
  if (season.placement === 1) html += ' (WINNER! ğŸ‘‘)';
  else if (season.placement === 2) html += ' (Runner-up)';
  html += '</li>\n';
  
  if (season.status) html += `      <li><b>Status:</b> ${season.status}</li>\n`;
  if (season.tribe) html += `      <li><b>Tribe:</b> ${season.tribe}</li>\n`;
  if (season.finalVote) html += `      <li><b>Final Vote:</b> ${season.finalVote}</li>\n`;
  if (season.juryVotes !== undefined) html += `      <li><b>Jury votes:</b> ${season.juryVotes}</li>\n`;
  
  html += '    </ul>\n  </div>\n';
  
  // Performance
  html += '  <div class="kpi">\n    <h3>Performance</h3>\n    <ul>\n';
  html += `      <li><b>Challenge wins:</b> ${season.challengeWins}</li>\n`;
  html += `      <li><b>Immunity wins:</b> ${season.immunityWins}</li>\n`;
  if (season.rewardWins !== undefined) html += `      <li><b>Reward wins:</b> ${season.rewardWins}</li>\n`;
  if (season.strategicRank) html += `      <li><b>Strategic rank:</b> ${season.strategicRank}</li>\n`;
  html += '    </ul>\n  </div>\n';
  
  // Advantages & Threat
  html += '  <div class="kpi">\n    <h3>Advantages & Threat</h3>\n    <ul>\n';
  html += `      <li><b>Votes received:</b> ${season.votesReceived}</li>\n`;
  if (season.idolsFound !== undefined) html += `      <li><b>Idols found:</b> ${season.idolsFound}</li>\n`;
  if (season.advantages && season.advantages.length > 0) {
    season.advantages.forEach(adv => {
      html += `      <li><b>Advantage:</b> ${adv}</li>\n`;
    });
  }
  if (isMostRecent && season.strategicRank) html += `      <li><b>Strategic rank:</b> ${season.strategicRank}</li>\n`;
  html += '    </ul>\n  </div>\n';
  
  // Notes
  if (season.notes && season.notes.length > 0) {
    html += '  <div class="kpi">\n    <h3>Notes</h3>\n    <ul>\n';
    season.notes.forEach(note => {
      html += `      <li>${note}</li>\n`;
    });
    html += '    </ul>\n  </div>\n';
  }
  
  html += '</div>\n';
  
  return html;
}
</script>

</body>
</html>
