<!doctype html>
<html lang="en" data-root=".">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Season Profile</title>
  <link rel="stylesheet" href="styles.css">
  
</head>
<body>
<!-- SITE HEADER START -->
<header class="modern-header" id="modernHeader">
  <div class="header-container">
    <div class="header-top">
      <a href="index.html" class="brand-section" aria-label="Go to home">
        <div class="brand-icon">
          <span class="brand-logo-text">âš¡</span>
        </div>
        <div class="brand-content">
          <h1>DC <span class="brand-gradient">Franchise</span> Database</h1>
          <p class="brand-subtitle">Season <span id="currentSeasonNum">5</span> Live â€¢ Click to Explore</p>
        </div>
      </a>
      <div class="stats-badge">
        <div class="stats-main"><span id="totalSeasons">5</span> Seasons â€¢ <span id="totalPlayers">58</span> Players</div>
        <div class="stats-sub">Icons: <span id="iconFormat">name.png</span></div>
      </div>
    </div>
    <nav class="header-nav" aria-label="Primary navigation">
      <ul class="nav-list">
        <li class="nav-item"><a href="index.html" class="nav-link"><span class="nav-icon">ğŸ </span><span>Home</span></a></li>
        <li class="nav-item"><a href="current-season.html" class="nav-link"><span class="nav-icon">ğŸ“Š</span><span>Current Season</span></a></li>
        <li class="nav-item"><a href="voting-analytics.html" class="nav-link"><span class="nav-icon">ğŸ§¾</span><span>Voting Analytics</span></a></li>
        <li class="nav-item"><a href="franchise.html" class="nav-link"><span class="nav-icon">ğŸ›ï¸</span><span>Franchise</span></a></li>
        <li class="nav-item"><a href="rankings.html" class="nav-link"><span class="nav-icon">ğŸ†</span><span>Rankings</span></a></li>
        <li class="nav-item"><a href="seasons.html" class="nav-link"><span class="nav-icon">ğŸ—‚ï¸</span><span>Seasons</span></a></li>
        <li class="nav-item"><a href="devotees.html" class="nav-link"><span class="nav-icon">ğŸ‘¥</span><span>Players</span></a></li>
        <li class="nav-item"><a href="awards.html" class="nav-link active"><span class="nav-icon">ğŸ…</span><span>Awards</span></a></li>
      </ul>
    </nav>
  </div>
</header>

<script>
(function() {
  if (window.SITE_CONFIG) {
    document.getElementById('totalSeasons').textContent = window.SITE_CONFIG.seasons;
    document.getElementById('totalPlayers').textContent = window.SITE_CONFIG.players;
    document.getElementById('currentSeasonNum').textContent = window.SITE_CONFIG.currentSeason;
    document.getElementById('iconFormat').textContent = window.SITE_CONFIG.iconFormat;
  }
  const header = document.getElementById('modernHeader');
  if (!header) return;
  window.addEventListener('scroll', () => {
    if (window.pageYOffset > 20) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  }, { passive: true });
})();
</script>
<!-- SITE HEADER END -->

<div class="container">
  <div class="topbar">
    <div>
      <div class="brand">DC <span>Franchise</span> Database</div>
      <div class="meta">Season Profile</div>
    </div>
    <div class="meta" id="topbar-stats">Season count: 5 â€¢ Player count: 58</div>
  </div>

  <div class="tabs">
    <a class="tab" href="current-season.html">ğŸ“Š Current Season Analytics</a>
    <a class="tab" href="voting-analytics.html">ğŸ—³ï¸ Voting Chart Analytics</a>
    <a class="tab" href="franchise.html">ğŸ›ï¸ Franchise Analytics</a>
    <a class="tab" href="rankings.html">ğŸ† Player Rankings</a>
    <a class="tab" href="seasons.html">ğŸ“š Seasons</a>
    <a class="tab" href="devotees.html">ğŸ‘¥ Devotees</a>
    <a class="tab" href="awards.html">ğŸ¥‡ Season Awards</a>
  </div>

  
<div id="season-content">
  <div class="hero">
    <h1>Loading seasonâ€¦</h1>
    <p>Please waitâ€¦</p>
  </div>
</div>

<script>
(async function() {
  const root = (document.documentElement.dataset.root || ".").replace(/\/+$/, "");
  const qs = new URLSearchParams(window.location.search);
  const seasonNum = qs.get('season');

  const content = document.getElementById('season-content');

  function esc(s){ return String(s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function playerHref(slug){
    return slug ? `${root}/player.html?player=${encodeURIComponent(slug)}` : "#";
  }

  function playerNameHtml(p){
    if (!p) return '';
    const name = esc(p.name);
    if (p.playerSlug) return `<a href="${playerHref(p.playerSlug)}"><b>${name}</b></a>`;
    return `<b>${name}</b>`;
  }

  if (!seasonNum) {
    content.innerHTML = `
      <div class="hero">
        <h1>âš ï¸ No Season Specified</h1>
        <p>Use a URL like <code>season_ref.html?season=5</code></p>
      </div>
      <div class="footer">
        <a href="${root}/seasons.html">â† All Seasons</a>
      </div>
    `;
    return;
  }

  try {
    const res = await fetch(`${root}/season${seasonNum}-data.json`);
    if (!res.ok) throw new Error(`season${seasonNum}-data.json not found`);
    const season = await res.json();

    // Title + stats
    document.title = `Season ${seasonNum} â€” ${season.title || ''}`.trim();
    const statsEl = document.getElementById('topbar-stats');
    if (statsEl && season.franchise?.totalSeasons) {
      statsEl.textContent = `Season count: ${season.franchise.totalSeasons} â€¢ Player count: ${season.franchise.totalPlayers || 58}`;
    }

    // Hero + summary callout (match your old pages: simple + clean)
    const finalists = Array.isArray(season.finalists) ? season.finalists : [];
    const finalLine = finalists.length
      ? finalists.map(f => `${esc(f.name)} (${esc(f.votes)} vote${Number(f.votes) === 1 ? '' : 's'}${f.note ? ' - ' + esc(f.note) : ''})`).join(', ')
      : '';

    // Cast image (no debug pill; just show if exists)
    const castImg = `${root}/assets/cast/s${seasonNum}-cast.png`;

    // Placements as cards (same style as seasons list)
    const placements = Array.isArray(season.placements) ? season.placements : [];
    const placementCards = placements.map(p => {
      const place = Number(p.placement);
      const placeLabel = place === 1 ? `ğŸ¥‡ #${place}` : (place === 2 ? `ğŸ¥ˆ #${place}` : `#${place}`);
      const initials = esc(String(p.name || '').slice(0,2).toUpperCase());
      const avatarImg = p.playerSlug ? `${root}/assets/avatars/${encodeURIComponent(p.playerSlug)}.png` : '';

      const leftAvatar = avatarImg
        ? `<div class="avatar" style="padding:0; overflow:hidden;">
             <img src="${avatarImg}" alt="${esc(p.name)}" style="width:100%;height:100%;object-fit:cover;" onerror="this.remove(); this.parentNode.textContent='${initials}';"/>
           </div>`
        : `<div class="avatar">${initials || '??'}</div>`;

      const href = p.playerSlug ? playerHref(p.playerSlug) : '#';

      return `
        <a class="card" href="${href}">
          <div class="row">
            ${leftAvatar}
            <div>
              <div class="name">${placeLabel} â€” ${esc(p.name || '')}</div>
              <div class="sub">${esc(p.phase || '')}${p.notes ? ` â€¢ ${esc(p.notes)}` : ''}</div>
            </div>
          </div>
          ${p.playerSlug ? '' : `<div class="badges"><span class="badge">No profile slug</span></div>`}
        </a>
      `;
    }).join('');

    // Stats tiles
    const st = season.statistics || {};
    const cw = st.challengeWins || {};
    const sg = st.socialGame || {};
    const strat = st.strategic || {};

    const challengeBeast = cw.mostTotal ? `${esc(cw.mostTotal.name)} â€” ${esc(cw.mostTotal.wins)} wins` : '';
    const mostTargeted = sg.mostVotes ? `${esc(sg.mostVotes.name)} â€” ${esc(sg.mostVotes.votes)} votes against` : '';
    const strategicMVP = season.awards?.bestStrategic?.name ? esc(season.awards.bestStrategic.name) : esc(season.winner?.name || '');

    content.innerHTML = `
      <div class="hero">
        <h1>ğŸï¸ Season ${esc(seasonNum)} â€” ${esc(season.title || '')}</h1>
        <p>${esc(season.castSize)} players â€¢ ${esc(season.episodeCount)} episodes â€¢ ${esc(season.subtitle || '')}</p>
      </div>

      <div class="callout">
        <b>Winner:</b> ${esc(season.winner?.name)} (${esc(season.winner?.vote)} over ${esc(season.winner?.runnerUp)})<br/>
        <b>Strategy:</b> ${esc(season.winner?.strategy)} â€¢ ${esc(season.winner?.keyStats)}<br/>
        ${finalLine ? `<b>Final ${finalists.length}:</b> ${finalLine}<br/>` : ''}
        ${season.awards?.fanFavorite?.name ? `<b>Fan Favorite:</b> ${esc(season.awards.fanFavorite.name)}${season.awards.fanFavorite.description ? ' â€” ' + esc(season.awards.fanFavorite.description) : ''}` : ''}
      </div>

      <h2>Season Overview</h2>
      <div class="panel">
        <ul>
          <li><b>Cast size:</b> ${esc(season.castSize)} players</li>
          <li><b>Winner:</b> ${esc(season.winner?.name)}</li>
          <li><b>Runner-up:</b> ${esc(season.winner?.runnerUp)}</li>
          <li><b>Theme:</b> ${esc(season.title || '')}</li>
          <li><b>Episodes:</b> ${esc(season.episodeCount)}</li>
          <li><b>Jury size:</b> ${esc(season.jurySize)}</li>
          <li><b>Final vote:</b> ${esc(season.winner?.vote)}</li>
        </ul>

        <div style="margin-top:14px;">
          <img src="${castImg}" alt="Season ${esc(seasonNum)} cast" style="width:100%; max-height:320px; object-fit:contain; border-radius:14px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25);"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"/>
          <div class="small" style="display:none; opacity:.75; margin-top:8px;">Cast photo missing: <code>assets/cast/s${esc(seasonNum)}-cast.png</code></div>
        </div>
      </div>

      <h2>ğŸ“Š Season Statistics</h2>
      <div class="kpi-grid">
        ${challengeBeast ? `
        <div class="kpi">
          <h3>Challenge Beast</h3>
          <p><b>${challengeBeast}</b></p>
          <p class="small">Physical dominance</p>
        </div>` : ''}

        ${mostTargeted ? `
        <div class="kpi">
          <h3>Most Targeted</h3>
          <p><b>${mostTargeted}</b></p>
          <p class="small">Most votes against</p>
        </div>` : ''}

        ${(strat.idolsFound || strat.idolsFound === 0) ? `
        <div class="kpi">
          <h3>Idols Found</h3>
          <p><b>${esc(strat.idolsFound)} total</b></p>
          <p class="small">Strategic chaos</p>
        </div>` : ''}

        <div class="kpi">
          <h3>Strategic MVP</h3>
          <p><b>${strategicMVP || esc(season.winner?.name || '')}</b></p>
          <p class="small">${season.awards?.bestStrategic?.description ? esc(season.awards.bestStrategic.description) : 'Controlled the game'}</p>
        </div>
      </div>

      <h2>ğŸ† Placements</h2>
      <div class="grid">
        ${placementCards || '<div class="panel" style="opacity:.8;">No placements found in the JSON.</div>'}
      </div>

      <div class="footer">
        <a href="${root}/season-awards.html?season=${encodeURIComponent(seasonNum)}">Season ${esc(seasonNum)} Awards â†’</a> |
        <a href="${root}/seasons.html">â† All Seasons</a>
      </div>
    `;

  } catch (err) {
    console.error(err);
    content.innerHTML = `
      <div class="hero">
        <h1>âš ï¸ Season Not Found</h1>
        <p>${esc(err.message)}</p>
      </div>
      <div class="panel">
        Make sure <code>season${esc(seasonNum)}-data.json</code> exists in your repo root.
      </div>
      <div class="footer">
        <a href="${root}/seasons.html">â† All Seasons</a>
      </div>
    `;
  }
})();
</script>

</div>

<footer class="siteFooter">
  <div class="footerInner">
    <div class="footerTitle">DC Franchise Database</div>
    <div class="footerSub">Static archive â€¢ 5 seasons â€¢ 58 players â€¢ Icons: name.png</div>
  </div>
</footer>

<script>
(function() {
  if (window.SITE_CONFIG) {
    document.getElementById('topbar-stats').textContent =
      `Season count: ${window.SITE_CONFIG.seasons} â€¢ Player count: ${window.SITE_CONFIG.players}`;
  }

  // Mark active tab based on path
  const currentPage = (window.location.pathname.split('/').pop() || 'index.html');
  document.querySelectorAll('.tabs .tab').forEach(a => {
    if (a.getAttribute('href') === currentPage) a.classList.add('active');
  });
  
  // Force active tab for dynamic pages
  document.querySelectorAll('.tabs .tab').forEach(a => {
    if (a.getAttribute('href') === 'seasons.html') a.classList.add('active');
  });

})();
</script>

</body>
</html>
